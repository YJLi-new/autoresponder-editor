<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AliMail Auto-Reply Template Studio</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&family=Noto+Sans+SC:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="bg-shape bg-shape-1"></div>
    <div class="bg-shape bg-shape-2"></div>

    <main class="shell">
      <section id="authGate" class="card auth-card">
        <div class="card-head">
          <p class="eyebrow">Authorized Access</p>
          <h1>AliMail 自动回复模板编辑器</h1>
          <p class="subtext">输入自定义访问密钥后进入编辑器。</p>
        </div>

        <form id="authForm" class="auth-form">
          <label>
            自定义访问密钥
            <input
              id="accessKeyInput"
              type="password"
              autocomplete="off"
              placeholder="请输入访问密钥"
              required
            />
          </label>
          <button type="submit" class="btn primary">验证并进入</button>
        </form>

        <div id="authStatus" class="status" aria-live="polite"></div>
      </section>

      <section id="editorApp" class="app hidden" aria-hidden="true">
        <header class="app-header card">
          <div>
            <p class="eyebrow">Template Studio</p>
            <h2>自动回复模板可视化编辑</h2>
            <p class="repo-badge">同类模板合并展示，中英版本可切换</p>
          </div>
          <div class="toolbar">
            <button id="exportBtn" class="btn ghost" type="button">导出 JSON</button>
            <button id="importBtn" class="btn ghost" type="button">导入 JSON</button>
            <button id="resetBtn" class="btn ghost" type="button">恢复默认模板</button>
            <button id="logoutBtn" class="btn danger" type="button">锁定</button>
          </div>
        </header>

        <div class="workspace">
          <aside class="panel list-panel">
            <div class="panel-head">
              <h3>模板列表</h3>
              <button id="addTemplateBtn" class="btn ghost" type="button">新建类别</button>
            </div>
            <ul id="templateList" class="template-list"></ul>
          </aside>

          <section class="panel form-panel">
            <div class="panel-head">
              <h3>模板内容</h3>
              <div class="panel-head-actions">
                <div id="editorLocaleSwitch" class="locale-switch" role="tablist" aria-label="语言切换">
                  <button id="editorLocaleZh" type="button" class="locale-btn" data-locale="zh-CN">中文</button>
                  <button id="editorLocaleEn" type="button" class="locale-btn" data-locale="en-US">English</button>
                </div>
                <button id="deleteTemplateBtn" class="btn danger ghost" type="button">删除类别</button>
              </div>
            </div>

            <form id="templateForm" class="template-form">
              <div class="inline-grid">
                <label>
                  模板类别（分组名）
                  <input id="categoryInput" name="category" type="text" required />
                </label>
                <label>
                  当前语言模板名
                  <input id="nameInput" name="name" type="text" required />
                </label>
              </div>

              <section class="meta-box">
                <p><strong>Template ID：</strong><span id="metaTemplateId"></span></p>
                <p><strong>关联规则：</strong><span id="metaRule"></span></p>
                <p><strong>路由部门：</strong><span id="metaRouting"></span></p>
                <p><strong>建议 SLA：</strong><span id="metaSla"></span></p>
                <p><strong>匹配字段：</strong><span id="metaMatchFields"></span></p>
                <p><strong>关键词/正则：</strong><span id="metaKeywords"></span></p>
                <p><strong>排除条件：</strong><span id="metaExclusions"></span></p>
                <p><strong>占位符：</strong><span id="metaPlaceholders"></span></p>
                <p><strong>备注：</strong><span id="metaNote"></span></p>
              </section>

              <div class="inline-grid">
                <label>
                  生效开始
                  <input id="startInput" name="startAt" type="datetime-local" />
                </label>
                <label>
                  生效结束
                  <input id="endInput" name="endAt" type="datetime-local" />
                </label>
              </div>

              <label>
                发送范围
                <select id="scopeInput" name="scope">
                  <option value="all">所有发件人</option>
                  <option value="internal">仅内部同域</option>
                  <option value="external">仅外部发件人</option>
                </select>
              </label>

              <label>
                主题
                <input id="subjectInput" name="subject" type="text" required />
              </label>

              <label>
                开场
                <textarea id="openingInput" name="opening" rows="2" required></textarea>
              </label>

              <label>
                正文
                <textarea id="bodyInput" name="body" rows="9" required></textarea>
              </label>

              <label>
                紧急联系人
                <input id="contactInput" name="fallbackContact" type="text" placeholder="support@company.com" />
              </label>

              <label>
                签名
                <textarea id="signatureInput" name="signature" rows="3"></textarea>
              </label>
            </form>

            <div class="token-row">
              <p>变量插入：</p>
              <div class="chips">
                <button class="chip" type="button" data-token="{{Name}}">Name</button>
                <button class="chip" type="button" data-token="{{OriginalSubject}}">OriginalSubject</button>
                <button class="chip" type="button" data-token="{{Product}}">Product</button>
                <button class="chip" type="button" data-token="{{Qty}}">Qty</button>
                <button class="chip" type="button" data-token="{{Destination}}">Destination</button>
                <button class="chip" type="button" data-token="{{OrderNo}}">OrderNo</button>
                <button class="chip" type="button" data-token="{{PI_No}}">PI_No</button>
              </div>
            </div>
          </section>

          <section class="panel preview-panel">
            <h3>实时预览</h3>
            <article class="mail-preview">
              <p class="preview-label">Subject</p>
              <p id="previewSubject" class="preview-subject"></p>
              <p class="preview-label">Body</p>
              <pre id="previewBody" class="preview-body"></pre>
            </article>
            <div class="preview-actions">
              <button id="copyTextBtn" class="btn ghost" type="button">复制纯文本</button>
              <button id="copyHtmlBtn" class="btn ghost" type="button">复制 HTML</button>
            </div>
            <div id="appStatus" class="status" aria-live="polite"></div>
          </section>
        </div>
      </section>

      <input id="importInput" type="file" accept="application/json,.json" hidden />
    </main>

    <script src="app.js" defer></script>
  </body>
</html>
